{%- macro label(event, person_context=None) -%}
    {%- import 'macro/person.html.j2' as personMacros -%}
    <a href="{{ ('/event/' ~ event.id) | url }}">{{ type_label(event) }}</a>


    {% set ns = namespace(subjects=[]) %}
    {% for presence in event.presences %}
        {% if PresenceRole.SUBJECT == presence.role and presence.person != person_context %}
            {% set ns.subjects = ns.subjects + [presence.person] %}
        {% endif %}
    {% endfor %}

    {%- if ns.subjects | length > 0 -%}
        {%- if person_context is not none and person_context in (event.presences | selectattr('role', 'equalto', PresenceRole.SUBJECT) | map(attribute='person')) %} with {% else %} of {% endif -%}
        {{ ns.subjects | sort(attribute='name') | map(personMacros.label) | join(' and ') }}
    {%- endif -%}
{%- endmacro -%}

{% macro type_label(event) -%}
    {%- set _type_labels = {
        EventType.BIRTH: 'Birth',
        EventType.BAPTISM: 'Baptism',
        EventType.CREMATION: 'Cremation',
        EventType.DEATH: 'Death',
        EventType.BURIAL: 'Burial',
        EventType.MARRIAGE: 'Marriage',
        EventType.MARRIAGE_BANNS: 'Marriage banns',
        EventType.RESIDENCE: 'Residence',
        EventType.IMMIGRATION: 'Immigration',
        EventType.EMIGRATION: 'Emigration',
    } -%}
    {{ _type_labels[event.type] }}
{%- endmacro -%}

{% macro presence_role_label(presence) -%}
    {%- set _role_labels = {
        PresenceRole.SUBJECT: 'Subject',
        PresenceRole.WITNESS: 'Witness',
    } -%}
    {%- if presence.role in _role_labels -%}
        {{ _role_labels[presence.role] }}
    {%- else -%}
        Attendee
    {%- endif -%}
{%- endmacro -%}
