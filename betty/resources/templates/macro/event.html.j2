{%- macro label(event, person_context=None) -%}
    {%- import 'macro/person.html.j2' as personMacros -%}
    <a href="{{ ('/event/' ~ event.id) | url }}">{{ type_label(event) }}</a>


    {% set ns = namespace(subjects=[]) %}
    {% for presence in event.presences %}
        {% if presence.Role.SUBJECT == presence.role and presence.person != person_context %}
            {% set ns.subjects = ns.subjects + [presence.person] %}
        {% endif %}
    {% endfor %}


    {%- if ns.subjects | length > 0 -%}
        {%- if person_context %} with {% else %} of {% endif -%}
        {{ ns.subjects | sort(attribute='names') | map(personMacros.label) | join(' and ') }}
    {%- endif -%}
{%- endmacro -%}

{% macro type_label(event) -%}
    {%- set _type_labels = {
        event.Type.BIRTH: 'Birth',
        event.Type.BAPTISM: 'Baptism',
        event.Type.CREMATION: 'Cremation',
        event.Type.DEATH: 'Death',
        event.Type.BURIAL: 'Burial',
        event.Type.MARRIAGE: 'Marriage',
        event.Type.RESIDENCE: 'Residence',
        event.Type.IMMIGRATION: 'Immigration',
        event.Type.EMIGRATION: 'Emigration',
    } -%}
    {{ _type_labels[event.type] }}
{%- endmacro -%}

{% macro presence_role_label(presence) -%}
    {%- set _role_labels = {
        presence.Role.SUBJECT: 'Subject',
        presence.Role.WITNESS: 'Witness',
    } -%}
    {%- if presence.role in _role_labels -%}
        {{ _role_labels[presence.role] }}
    {%- else -%}
        Attendee
    {%- endif -%}
{%- endmacro -%}
