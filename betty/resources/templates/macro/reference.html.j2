{%- macro label(reference) -%}
    {{ _link(reference) }}
    {%- set containing_references = reference | walk('contained_by') | takewhile('ne', None) | list -%}
    {%- if containing_references | length > 0 %} ({{ containing_references | map(_link) | join(', ') }}){%- endif -%}
{%- endmacro -%}

{% macro use(references) -%}
    {% set numberedReferences = [] %}
    {% for reference in references %}
        {% set numberedReferences = [(references.use(reference), reference)] + numberedReferences %}
    {% endfor %}
    {% for number, reference in numberedReferences | sort(attribute=0) %}
        <a href="#reference-footnote-{{ referenceNumber }}" class="reference-usage">[{{ referenceNumber }}]</a>
    {% endfor %}
{%- endmacro -%}

{% macro _link(reference) -%}
    <a href="{{ ('/reference/' ~ reference.id) | url }}">{{ reference.name }}</a>
{%- endmacro -%}
