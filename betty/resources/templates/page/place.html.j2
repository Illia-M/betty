{% extends 'page/base.html.j2' %}
{% set title = place.name %}
{% block content %}
    {% include 'place-meta.html.j2' %}

    {% set place_ids = place | walk('encloses') | map(attribute='id') %}
    {% if place.coordinates %}
        {% set place_ids = place_ids | list + [place.id] %}
    {% endif %}
    {% if place_ids is defined %}
        <div class="map" id="map-{{ place.id }}" data-place-ids="{{ place_ids | join(',') }}"></div>
    {% endif %}

    {% set events = place.events | list + place | walk('encloses') | map(attribute="events") | flatten | list %}
    {% if events | rejectattr('date', 'none') | rejectattr('date.year', 'none') | rejectattr('date.month', 'none') | rejectattr('date.day', 'none') | list | length > 0 %}
        <h2>Events</h2>
        {% with events=events, place_context=place %}
            {% include 'list-event.html.j2' %}
        {% endwith %}
    {% endif %}
{% endblock %}